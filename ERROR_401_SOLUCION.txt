================================================================================
                    SOLUCI√ìN ERROR 401 - UNAUTHORIZED
================================================================================

PROBLEMA:
  Recibiste error 401 (Unauthorized) al intentar hacer login

CAUSA PROBABLE:
  Uno de estos:
  1. La tabla 'users' no fue creada
  2. El usuario admin@empresa.com no existe
  3. El usuario est√° inactivo
  4. La contrase√±a no coincide con el hash

================================================================================
                              SOLUCI√ìN R√ÅPIDA (5 MIN)
================================================================================

PASO 1: Ejecutar script de verificaci√≥n
  
  bash
  node scripts/verify-database.js
  

Este script te dir√° EXACTAMENTE cu√°l es el problema.

PASO 2: Seg√∫n el resultado del script:

  ‚ùå "La tabla 'users' NO existe"
     ‚Üí Ejecuta: mysql -h localhost -u creditivoo_ordersuser \
                   -pC4ed1t1voo creditivoo_ivooApp \
                   < scripts/setup-users-auth.sql

  ‚ùå "NO hay usuarios en la base de datos"
     ‚Üí Ejecuta: mysql -h localhost -u creditivoo_ordersuser \
                   -pC4ed1t1voo creditivoo_ivooApp \
                   < scripts/insert-test-user.sql

  ‚ùå "El usuario est√° INACTIVO"
     ‚Üí Ejecuta en MySQL:
        UPDATE users SET is_active = TRUE 
        WHERE email = 'admin@empresa.com';

PASO 3: Reinicia el servidor
  
  bash
  npm run dev
  

PASO 4: Intenta login
  Email: admin@empresa.com
  Password: admin123

================================================================================
                           VERIFICACI√ìN MANUAL
================================================================================

Si no quieres usar el script, puedes verificar manualmente:

1. Conectar a MySQL
   mysql -h localhost -u creditivoo_ordersuser -pC4ed1t1voo \
         creditivoo_ivooApp

2. Verificar que la tabla existe
   SHOW TABLES;
   
   Deber√≠as ver: users

3. Ver estructura de la tabla
   DESC users;
   
   Deber√≠as ver estas columnas:
   - id
   - email
   - password_hash
   - full_name
   - role
   - is_active
   - created_at
   - last_login
   - api_token
   - api_token_created_at

4. Ver todos los usuarios
   SELECT id, email, full_name, role, is_active FROM users;

5. Buscar usuario espec√≠fico
   SELECT * FROM users WHERE email = 'admin@empresa.com';

6. Si el usuario existe pero est√° inactivo
   UPDATE users SET is_active = TRUE WHERE email = 'admin@empresa.com';

7. Si el usuario NO existe, insertarlo
   INSERT INTO users (email, password_hash, full_name, role, phone, is_active) 
   VALUES ('admin@empresa.com', 
           '$2b$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcg7b3XeKeUxWdeS86E36P4/KFm', 
           'Admin', 
           'admin', 
           '+1234567890', 
           TRUE);

================================================================================
                           INFORMACI√ìN DE CONEXI√ìN
================================================================================

Host: localhost
Usuario: creditivoo_ordersuser
Contrase√±a: C4ed1t1voo
Base de datos: creditivoo_ivooApp
Puerto: 3306

DATABASE_URL:
  mysql://creditivoo_ordersuser:C4ed1t1voo@localhost:3306/creditivoo_ivooApp

================================================================================
                         CREDENCIALES DE PRUEBA
================================================================================

Email: admin@empresa.com
Password: admin123

Hash (bcrypt): $2b$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcg7b3XeKeUxWdeS86E36P4/KFm

================================================================================
                              DOCUMENTACI√ìN
================================================================================

Para m√°s informaci√≥n, consulta estos archivos:

- SOLUCIONAR_ERROR_401.md     ‚Üí Gu√≠a completa de soluci√≥n
- DIAGNOSTICO.md              ‚Üí Pasos detallados de diagn√≥stico
- FLOWCHART_SOLUCION.md       ‚Üí √Årbol de decisiones visual
- scripts/verify-database.js  ‚Üí Script de verificaci√≥n autom√°tica
- scripts/test-auth.js        ‚Üí Script de test de autenticaci√≥n
- docs/API_EXAMPLES.md        ‚Üí Ejemplos de uso de la API

================================================================================
                            CHECKLIST FINAL
================================================================================

‚òê Ejecut√© node scripts/verify-database.js
‚òê La tabla users existe
‚òê Hay usuarios en la BD
‚òê El usuario admin@empresa.com existe
‚òê El usuario admin@empresa.com est√° activo (is_active = 1)
‚òê La contrase√±a es: admin123
‚òê Reinici√© el servidor (npm run dev)
‚òê Intento login sin errores

‚úÖ Si todas est√°n ‚òë, deber√≠as poder hacer login!

================================================================================
                         SI SIGUE SIN FUNCIONAR
================================================================================

1. Abre la consola del navegador (F12)
2. Revisa los logs de la consola del servidor (donde ejecutaste npm run dev)
3. Busca l√≠neas que comiencen con [v0]
4. Copia los logs y analiza qu√© dice exactamente

5. Tambi√©n puedes ejecutar este test en la consola del navegador:

   fetch('/api/auth/login', {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify({ 
       email: 'admin@empresa.com', 
       password: 'admin123' 
     }),
     credentials: 'include'
   })
   .then(r => r.json())
   .then(d => console.log(d));

6. Copia la respuesta que ves en la consola

================================================================================
                       PR√ìXIMOS PASOS (CUANDO FUNCIONE)
================================================================================

Una vez que logres hacer login correctamente:

1. Deber√≠as ver el Dashboard
2. En el sidebar, ver√°s "Gestionar Usuarios"
3. Ah√≠ podr√°s:
   - Ver lista de todos los usuarios
   - Crear nuevos usuarios
   - Editar usuarios existentes
   - Eliminar usuarios
4. El Bearer token se genera autom√°ticamente al hacer login
5. Se guarda en localStorage para usarlo en futuras peticiones

¬°Listo! Tu sistema de autenticaci√≥n con Bearer tokens est√° funcionando. üéâ

================================================================================
